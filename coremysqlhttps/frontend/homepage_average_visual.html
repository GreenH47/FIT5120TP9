<!-- user input form -->
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="structure.css" />
    </head>
    <form method="post">
        <div class="row">
            <div class="header">
                <img src="CarbonVic-logos_black.png" width="610px" height="150px">
            </div>
            <div class="header2">
                <img src="Default_Melbounre_city_in_a_forest_style_0.jpg" width="750px" height="150px" class="transparent-image">
            </div>
        </div>

        <div class="row">
            <!--link to four_part element-->
            <a href="#calculator">calculator</a>
        </div>

        <div class="row">
            <div class="six_part">
                <h2>Lets Calculate your Carbon Footprint</h2>
                <p>Thank you for visiting our website and let us see what
                    is your climate impact!<br><br> 
                    
                    Our calculator can estimate your carbon footprint based
                    on your electricity, water and gas usage each month.<br><br> 
                    
                    This calculator only helps in calculating the carbon 
                    footprint hence if there are more complex measurements
                    please find a external Carbon Advisors to ask more 
                    advice on the carbon emissions. </p>
            </div>
            
            
        </div>

        <div class="row">
            <div class="four_part" id="calculator">
                <h2>Input information</h2>
                
                
                
                <div class="input-group">
                    <label for="electricity">
                        Electricity:
                        <span class="question-mark" onclick="eleInstructions()">?</span>
                    </label>
                    <input type="number" step="any" id="electricity" name="Electricity" placeholder="Enter kWh/month" required onchange="calculateCarbon()" />
                </div>
            
                <div class="input-group">
                    <label for="gas">
                        Gas:
                        <span class="question-mark" onclick="gasInstructions()">?</span>
                    </label>
                    <input type="number" step="any" id="gas" name="Gas" placeholder="Enter MJ/month" required onchange="calculateCarbon()" />
                </div>
                

                <div class="input-group">
                    <label for="carbon" style="display:none;">Carbon:</label>
                    <input type="number" step="any" id="carbon" name="Carbon" style="display:none;" readonly />
                </div>
                
                <div class="button-group">
                    <button type="button" onclick="combineFunctions()">Submit</button>
                </div>
                
            </div>
        </div>




    <script>

        
    </script>



    <script>

        var globalData;

        function eleInstructions() {
            // Replace the following alert with your own pop-up window or tooltip logic
            alert("Instructions: Please enter the amount of electricity consumed per month in kilowatt-hours (kWh). You can find this information on your electricity bill or utility statement.");
        }
        function gasInstructions() {
            // Replace the following alert with your own pop-up window or tooltip logic
            alert("Instructions: Please enter the amount of gas consumed per month in megajoules (MJ). You can find this information on your gas bill or utility statement.");
        }


        function combineFunctions() {
                calculateCarbon();
                generateJSON();
                //delay 1s and jump to footPrint element
                setTimeout(function() {
                    document.getElementById("footPrint").scrollIntoView({ behavior: "smooth" });
                }, 1000);
                
        }

        function generateJSON() {
            var subarea = document.getElementById("subarea").value;
            var electricity = parseFloat(document.getElementById("electricity").value);
            var gas = parseFloat(document.getElementById("gas").value);
            var carbon = parseFloat(document.getElementById("carbon").value);

            var jsonObject = {
                "Subarea": subarea,
                "Electricity": electricity,
                "Gas": gas,
                "Carbon": carbon
            };

            var jsonString = JSON.stringify(jsonObject);
            console.log(jsonString); // Display the JSON in the console
            sendDataToAPI(jsonString);
        }

        // Send the JSON to the API
        function sendDataToAPI(jsonString) {
            fetch("https://acxyxgzu6e.execute-api.us-east-1.amazonaws.com/deploy", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: jsonString
            })
                .then(response => response.json())
                .then(data => {
                    document.getElementById("footPrint").style.display = "block";
                    console.log(data); // Display the JSON response in the console
                    document.getElementById("carbonMessage").style.display = "block";
                    document.getElementById("yesButton").style.display = "block"; 
                    document.getElementById("noButton").style.display = "block";
                    // Call the function in script 2 and pass the JSON response as an argument
                    dataVisual(data);
                    globalData = data;
                })
                .catch(error => console.error(error));
        }


        function displayAvgData() {
            var carbonMessage = document.getElementById("carbonMessage");
            var yesButton = document.getElementById("yesButton");
            var noButton = document.getElementById("noButton");
            subarea_selection.style.display = "block";

            carbonMessage.style.display = "none";
            yesButton.style.display = "none";
            noButton.style.display = "none";
            document.getElementById("footPrint2").style.display = "block";
            document.getElementById("environmental").style.display = "block";

            
            //dataVisualAvg(globalData);
        }
    </script>

    <script>
        function hideElements() {
            var carbonMessage = document.getElementById("carbonMessage");
            var yesButton = document.getElementById("yesButton");
            var noButton = document.getElementById("noButton");
            carbonMessage.style.display = "none";
            yesButton.style.display = "none";
            noButton.style.display = "none";
}

    </script>

    </form>
    <!-- data visualization part -->
    <div class="row">
        <div class="four_part2">
            <h2 id="footPrint" style="display:none;">Your Total Carbon Footprint</h2>
            <div id="chart-container"></div>
            <div id="jsonOutput"style="display:none;"></div>
        </div>
        <div class="six_part2">
            <div id="carbonMessage" style="display:none;">
                This is your total carbon footprint! Do you want 
                to compare your total carbon footprint with your
                surrounding suburbs?
            </div>
            <div class="button-container">
                <button type="button" id="yesButton" style="display:none;" onclick="displayAvgData()">Yes</button>
                <button type="button" id="noButton" style="display:none;" onclick="hideElements()">No</button>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="input-group">
            <div id="subarea_selection" style="display:none;">
                <label for="subarea">Subarea:</label>
                <select id="subarea" name="Subarea" required>
                    <option value="Lysterfield South" selected>Lysterfield South</option>
                    <option value="Doveton and Eumemmerring">Doveton and Eumemmerring</option>
                    <option value="Endeavour Hills">Endeavour Hills</option>
                    <option value="Hallam">Hallam</option>
                    <option value="Narre Warren North">Narre Warren North</option>
                    <option value="Narre Warren and Narre Warren South">Narre Warren and Narre Warren South</option>
                    <option value="Berwick and Harkaway">Berwick and Harkaway</option>
                    <option value="Beaconsfield">Beaconsfield</option>
                    <option value="Pearcedale">Pearcedale</option>
                    <option value="Lynbrook and Lyndhurst">Lynbrook and Lyndhurst</option>
                    <option value="Hampton Park">Hampton Park</option>
                    <option value="Botanic Ridge, Cannons Creek, Cranbourne">Botanic Ridge, Cannons Creek, Cranbourne</option>
                    <option value="Clyde and Clyde North">Clyde and Clyde North</option>
                    <option value="Blind Bight, Tooradin and Warneet">Blind Bight, Tooradin and Warneet</option>
                </select>
                <button type="button" id="subareaButton" onclick="resubmitFunctions()">reSubmit</button>
            </div>
            
        </div>
    </div>

    <script>
        //recall combineFunctions() and recall the displayAvgData()
        function resubmitFunctions(){

            combineFunctions();
            displayAvgData();
            dataVisualAvg(globalData);

            //delay 300ms and jump to chart-container2
            setTimeout(function(){
                document.getElementById("chart-container2").scrollIntoView({ behavior: "smooth" });
            }, 200);

            //delay 1000ms 
            setTimeout(function(){
                //jump to 
                carbonMessage.style.display = "none";
                yesButton.style.display = "none";
                noButton.style.display = "none";
            }, 1000);
            

        }
        
    </script>


    <div class="row">
        <div class="four_part3">
            <h2 id="footPrint2" style="display:none;">Surburb Carbon Footprint</h2>
            <div id="chart-container2"></div>
            <div id="jsonOutput2"style="display:none;"></div>
        </div>
        <div class="six_part3">
            <img id="environmental" src="edited_environmental.png" style="display:none;">
        </div>
    </div>



</html>


<script src="https://d3js.org/d3.v7.min.js"></script> 

<script>
    //data visualization part
    function dataVisualAvg(jsonResponse) {


        d3.select("#chart-container2").html("");
        // Access the HTML element where you want to display the JSON response
        var outputElement = document.getElementById("jsonOutput2");

        // Convert the JSON response to a string and assign it to the innerHTML of the output element
        outputElement.innerHTML = JSON.stringify(jsonResponse);

        // Parse the JSON data
        const parsedData = JSON.parse(jsonResponse.body);

        // Extract the user_input data for the pie chart
        const average_data = parsedData.average;

        // Extract the keys and values for the pie chart
        const average_electricityPercentage = (average_data.Electricity * 0.389) / average_data.Carbon;
        const average_gasPercentage = (average_data.Gas * 0.069) / average_data.Carbon;
        // Extract the carbon value
        const average_carbonValue = average_data.Carbon;

        // Create an array of objects to pass to D3 pie function
        const dataForPie = [
            { label: "Electricity", value: average_electricityPercentage },
            { label: "Gas", value: average_gasPercentage }
        ];

        // Set up the dimensions for the chart
        const width = 300;
        const height = 300;
        const radius = Math.min(width, height) / 2;
        const colors = ["lightblue", "#69a3b2"];

        // Create an SVG element and append it to the chart container
        const svg = d3.select("#chart-container2")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", `translate(${width / 2}, ${height / 2})`);

        // Create the pie layout
        const pie = d3.pie().value(d => d.value);

        // Create the arc for each slice
        const arc = d3.arc()
            .innerRadius(radius * 0.5)
            .outerRadius(radius);

        // Create the pie chart
        const arcs = svg.selectAll("arc")
            .data(pie(dataForPie))
            .enter()
            .append("g");

        // Add the slices to the chart
        arcs.append("path")
            .attr("d", arc)
            .attr("fill", (d, i) => colors[i]);

        // Add text labels for each slice
        arcs.append("text")
            .attr("transform", d => `translate(${arc.centroid(d)})`)
            .attr("text-anchor", "middle")
            .style("font-size", "10px")
            .text(d => d.data.label + ": " + (d.data.value * 100).toFixed(2) + "%");
        
            svg.append("text")
            .attr("x", 0)
            .attr("y", 0)
            .attr("text-anchor", "middle")
            .style("font-size", "11px")
            .style("font-weight", "bold")
            .text(`Carbon: ${average_carbonValue}`);
    }
</script>


<script>


    function calculateCarbon() {
        var electricityValue = parseFloat(document.getElementById("electricity").value);
        var gasValue = parseFloat(document.getElementById("gas").value);
        var carbonValue = 0.389 * electricityValue + 0.069 * gasValue;
        document.getElementById("carbon").value = carbonValue.toFixed(2);
        return carbonValue;
    }

    //data visualization part
    function dataVisual(jsonResponse) {

        d3.select("#chart-container").html("");

        // Access the HTML element where you want to display the JSON response
        var outputElement = document.getElementById("jsonOutput");
        var carbonValue = calculateCarbon();

        // Convert the JSON response to a string and assign it to the innerHTML of the output element
        outputElement.innerHTML = JSON.stringify(jsonResponse);

        // Parse the JSON data
        const parsedData = JSON.parse(jsonResponse.body);

        // Extract the user_input data for the pie chart
        const user_input_data = parsedData.user_input;

        // Extract the keys and values for the pie chart
        const electricityPercentage = (user_input_data.Electricity * 0.389) / user_input_data.Carbon;
        const gasPercentage = (user_input_data.Gas * 0.069) / user_input_data.Carbon;

        // Create an array of objects to pass to D3 pie function
        const dataForPie = [
            { label: "Electricity", value: electricityPercentage },
            { label: "Gas", value: gasPercentage }
        ];

        // Set up the dimensions for the chart
        const width = 300;
        const height = 300;
        const radius = Math.min(width, height) / 2;
        const colors = ["lightblue", "#69a3b2"];

        // Create an SVG element and append it to the chart container
        const svg = d3.select("#chart-container")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", `translate(${width / 2}, ${height / 2})`);

        // Create the pie layout
        const pie = d3.pie().value(d => d.value);

        // Create the arc for each slice
        const arc = d3.arc()
            .innerRadius(radius * 0.5)
            .outerRadius(radius);

        // Create the pie chart
        const arcs = svg.selectAll("arc")
            .data(pie(dataForPie))
            .enter()
            .append("g");

        // Add the slices to the chart
        arcs.append("path")
            .attr("d", arc)
            .attr("fill", (d, i) => colors[i]);

        // Add text labels for each slice
        arcs.append("text")
            .attr("transform", d => `translate(${arc.centroid(d)})`)
            .style("font-size", "10px")
            .attr("text-anchor", "middle")
            .text(d => d.data.label + ": " + (d.data.value * 100).toFixed(2) + "%");
            svg.append("text")
            .attr("x", 0)
            .attr("y", 0)
            .attr("text-anchor", "middle")
            .style("font-size", "11px")
            .style("font-weight", "bold")
            .text(`Carbon: ${carbonValue.toFixed(2)}`);
            
    }
</script>
